<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ â€” Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f172a; --paper: #fdfbf7; --muted: #64748b; --accent: #b8862f;
      --ink: #1e293b; --radius: 20px; --shadow: 0 10px 30px rgba(0,0,0,0.3);
      --sans: 'Cairo', sans-serif; --serif: 'Amiri', serif;
    }
    .dark { --bg: #020617; --paper: #1e293b; --ink: #f1f5f9; --muted: #94a3b8; }

    body { margin: 0; background: var(--bg); font-family: var(--sans); color: var(--ink); overflow: hidden; transition: background 0.3s; }
    .app { display: flex; flex-direction: column; height: 100vh; }

    header.app-bar {
      padding: 12px 20px; display: flex; align-items: center; justify-content: space-between;
      background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 1000;
    }
    .brand .title { font-size: 18px; font-weight: 800; color: #fff; margin: 0; }
    .brand .subtitle { font-size: 10px; color: var(--muted); }

    .shell { flex: 1; display: flex; overflow: hidden; position: relative; }
    .reader-wrap { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 120px; scroll-behavior: smooth; }
    .mushaf-card {
      background: var(--paper); border-radius: var(--radius); padding: 30px 20px;
      box-shadow: var(--shadow); max-width: 800px; margin: 0 auto; min-height: 80vh;
    }
    .surah-title { font-family: var(--serif); font-size: 32px; text-align: center; color: var(--accent); margin-bottom: 25px; }
    .page-text { font-family: var(--serif); font-size: 26px; line-height: 2.3; text-align: justify; text-align-last: center; }

    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª */
    .verse { cursor: pointer; padding: 2px 4px; border-radius: 8px; transition: 0.2s; display: inline; border-right: 4px solid transparent; }
    .verse:hover { background: rgba(184, 134, 47, 0.1); }
    .verse.marked-gold { border-right-color: #b8862f; background: rgba(184, 134, 47, 0.15); }
    .verse.marked-green { border-right-color: #10b981; background: rgba(16, 185, 129, 0.15); }
    .verse.marked-red { border-right-color: #ef4444; background: rgba(239, 68, 68, 0.15); }
    
    .verse-num {
      font-family: var(--sans); font-size: 14px; color: var(--accent); font-weight: bold;
      margin: 0 6px; display: inline-flex; width: 30px; height: 30px;
      border: 1px solid var(--accent); border-radius: 50%; align-items: center; justify-content: center;
    }

    .sidebar {
      position: fixed; right: -100%; top: 0; bottom: 0; width: 85%; max-width: 320px;
      background: var(--bg); z-index: 2000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 20px; display: flex; flex-direction: column; box-shadow: -10px 0 30px rgba(0,0,0,0.5);
    }
    .sidebar.open { right: 0; }
    .toc { flex: 1; overflow-y: auto; margin-top: 20px; padding-right: 5px; }
    .toc a {
      display: flex; justify-content: space-between; padding: 14px;
      background: rgba(255,255,255,0.05); margin-bottom: 8px; border-radius: 12px;
      text-decoration: none; color: #fff; font-size: 14px; border: 1px solid rgba(255,255,255,0.05);
    }

    .bottom-bar {
      position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
      width: 90%; max-width: 450px; background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 100px; display: flex; justify-content: space-between;
      padding: 8px 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); z-index: 1000;
    }
    .btn { border: none; background: var(--accent); color: white; padding: 10px 20px; border-radius: 50px; font-weight: 700; cursor: pointer; }
    .btn-icon { background: rgba(255,255,255,0.1); color: white; width: 48px; height: 48px; border-radius: 50%; border: none; font-size: 20px; cursor: pointer; }

    .tafsir-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: flex-end; justify-content: center; z-index: 3000; }
    .tafsir-panel { background: var(--paper); width: 100%; max-width: 600px; border-radius: 30px 30px 0 0; padding: 25px; max-height: 80vh; overflow-y: auto; }
    
    /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
    .mark-tools { display: flex; align-items: center; gap: 12px; margin: 15px 0; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 12px; }
    .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: 0.2s; }
    .color-dot:hover { transform: scale(1.1); }
    .choice-btn { background: #111; color: #fff; border: none; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; flex: 1; font-size: 13px; }

    @media (min-width: 768px) {
      .sidebar { position: static; right: 0; width: 350px; margin: 15px; border-radius: 20px; }
      .tafsir-modal { align-items: center; padding: 20px; }
      .tafsir-panel { border-radius: 25px; }
    }
  </style>
</head>
<body class="dark">

<div class="app">
  <header class="app-bar">
    <div class="brand">
      <h1 class="title">Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ</h1>
      <div class="subtitle">Ù‚Ø§Ø±Ø¦ Ø°ÙƒÙŠ Ù…Ø¹ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªÙˆÙ‚Ù</div>
    </div>
    <div style="display:flex; gap:8px;">
      <button class="btn-icon"><a style="text-decoration: none;" href="a.html">ğŸ§</a></button>
      <button class="btn-icon" id="toggleTheme">ğŸŒ“</button>
      <button class="btn" id="openMenu">â˜° Ø§Ù„ÙÙ‡Ø±Ø³</button>
    </div>
  </header>

  <div class="shell">
    <main class="reader-wrap">
      <div class="mushaf-card" id="mushafCard">
        <div id="pageMeta" style="text-align: center; color: var(--muted); font-size: 13px; margin-bottom: 10px;">
          ØµÙØ­Ø© <span id="pageIdx">1</span> Ù…Ù† 604
        </div>
        <div class="surah-title" id="surahName">Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©</div>
        <article id="mushafContent" class="page-text">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</article>
      </div>
    </main>

    <aside class="sidebar" id="sidebar">
      <h2 style="color:#fff; margin-bottom:15px;">ÙÙ‡Ø±Ø³ Ø§Ù„Ø³ÙˆØ±</h2>
      <div class="toc" id="toc"></div>
      <button id="closeMenu" class="btn" style="margin-top:10px; width:100%">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙÙ‡Ø±Ø³</button>
    </aside>
  </div>

  <div class="bottom-bar">
    <button class="btn-icon" id="prevPage">â—€</button>
    <button class="btn" id="btnRandom">ğŸ² Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
    <button class="btn-icon" id="nextPage">â–¶</button>
  </div>
</div>

<div id="tafsirModal" class="tafsir-modal">
  <div class="tafsir-panel">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 id="tafsirTitle" style="margin:0; color:var(--accent);">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¢ÙŠØ©</h3>
      <button id="tafsirClose" style="border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    
    <p id="tafsirMeta" style="color:var(--muted); font-size:14px; margin:10px 0;"></p>

    <div class="mark-tools">
      <span style="font-size:13px; font-weight:bold;">ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø©:</span>
      <div class="color-dot" style="background:#b8862f" onclick="setMark('gold')" title="Ø¹Ù„Ø§Ù…Ø© Ø°Ù‡Ø¨ÙŠØ©"></div>
      <div class="color-dot" style="background:#10b981" onclick="setMark('green')" title="Ø¹Ù„Ø§Ù…Ø© Ø®Ø¶Ø±Ø§Ø¡"></div>
      <div class="color-dot" style="background:#ef4444" onclick="setMark('red')" title="Ø¹Ù„Ø§Ù…Ø© Ø­Ù…Ø±Ø§Ø¡"></div>
      <button id="clearMarkBtn" style="margin-right:auto; background:none; border:1px solid #ccc; padding:4px 8px; border-radius:5px; cursor:pointer; font-size:11px;">Ø­Ø°Ù Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</button>
    </div>

    <div style="display:flex; gap:5px; margin-bottom:15px;" id="ksuButtons"></div>
    <div id="tafsirContent" style="background:rgba(0,0,0,0.03); padding:15px; border-radius:15px; line-height:1.8; font-size:17px; font-family:var(--serif);"></div>
    <button id="showLocalBtn" style="width:100%; background:var(--accent); color:white; border:none; padding:15px; border-radius:15px; font-weight:bold; margin-top:15px; cursor:pointer;">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±</button>
  </div>
</div>

<script>
(function(){
  const SURA_TABLE = [{n:1, s:'Ø§Ù„ÙØ§ØªØ­Ø©', p:1},{n:2, s:'Ø§Ù„Ø¨Ù‚Ø±Ø©', p:2},{n:3, s:'Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†', p:50},{n:4, s:'Ø§Ù„Ù†Ø³Ø§Ø¡', p:77},{n:5, s:'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©', p:106},{n:6, s:'Ø§Ù„Ø£Ù†Ø¹Ø§Ù…', p:128},{n:7, s:'Ø§Ù„Ø£Ø¹Ø±Ø§Ù', p:151},{n:8, s:'Ø§Ù„Ø£Ù†ÙØ§Ù„', p:177},{n:9, s:'Ø§Ù„ØªÙˆØ¨Ø©', p:187},{n:10, s:'ÙŠÙˆÙ†Ø³', p:208},{n:11, s:'Ù‡ÙˆØ¯', p:221},{n:12, s:'ÙŠÙˆØ³Ù', p:234},{n:13, s:'Ø§Ù„Ø±Ø¹Ø¯', p:246},{n:14, s:'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…', p:249},{n:15, s:'Ø§Ù„Ø­Ø¬Ø±', p:255},{n:16, s:'Ø§Ù„Ù†Ø­Ù„', p:262},{n:17, s:'Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡', p:282},{n:18, s:'Ø§Ù„ÙƒÙ‡Ù', p:293},{n:19, s:'Ù…Ø±ÙŠÙ…', p:305},{n:20, s:'Ø·Ù‡', p:312},{n:21, s:'Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡', p:322},{n:22, s:'Ø§Ù„Ø­Ø¬', p:332},{n:23, s:'Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†', p:342},{n:24, s:'Ø§Ù„Ù†ÙˆØ±', p:350},{n:25, s:'Ø§Ù„ÙØ±Ù‚Ø§Ù†', p:356},{n:26, s:'Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡', p:361},{n:27, s:'Ø§Ù„Ù†Ù…Ù„', p:367},{n:28, s:'Ø§Ù„Ù‚ØµØµ', p:373},{n:29, s:'Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª', p:381},{n:30, s:'Ø§Ù„Ø±ÙˆÙ…', p:386},{n:31, s:'Ù„Ù‚Ù…Ø§Ù†', p:392},{n:32, s:'Ø§Ù„Ø³Ø¬Ø¯Ø©', p:396},{n:33, s:'Ø§Ù„Ø£Ø­Ø²Ø§Ø¨', p:399},{n:34, s:'Ø³Ø¨Ø£', p:404},{n:35, s:'ÙØ§Ø·Ø±', p:408},{n:36, s:'ÙŠØ³', p:412},{n:37, s:'Ø§Ù„ØµØ§ÙØ§Øª', p:417},{n:38, s:'Øµ', p:421},{n:39, s:'Ø§Ù„Ø²Ù…Ø±', p:425},{n:40, s:'ØºØ§ÙØ±', p:430},{n:41, s:'ÙØµÙ„Øª', p:434},{n:42, s:'Ø§Ù„Ø´ÙˆØ±Ù‰', p:438},{n:43, s:'Ø§Ù„Ø²Ø®Ø±Ù', p:442},{n:44, s:'Ø§Ù„Ø¯Ø®Ø§Ù†', p:445},{n:45, s:'Ø§Ù„Ø¬Ø§Ø«ÙŠØ©', p:448},{n:46, s:'Ø§Ù„Ø£Ø­Ù‚Ø§Ù', p:451},{n:47, s:'Ù…Ø­Ù…Ø¯', p:455},{n:48, s:'Ø§Ù„ÙØªØ­', p:458},{n:49, s:'Ø§Ù„Ø­Ø¬Ø±Ø§Øª', p:460},{n:50, s:'Ù‚', p:462},{n:51, s:'Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª', p:464},{n:52, s:'Ø§Ù„Ø·ÙˆØ±', p:467},{n:53, s:'Ø§Ù„Ù†Ø¬Ù…', p:469},{n:54, s:'Ø§Ù„Ù‚Ù…Ø±', p:471},{n:55, s:'Ø§Ù„Ø±Ø­Ù…Ù†', p:473},{n:56, s:'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©', p:475},{n:57, s:'Ø§Ù„Ø­Ø¯ÙŠØ¯', p:477},{n:58, s:'Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©', p:479},{n:59, s:'Ø§Ù„Ø­Ø´Ø±', p:481},{n:60, s:'Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©', p:483},{n:61, s:'Ø§Ù„ØµÙ', p:484},{n:62, s:'Ø§Ù„Ø¬Ù…Ø¹Ø©', p:486},{n:63, s:'Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†', p:487},{n:64, s:'Ø§Ù„ØªØºØ§Ø¨Ù†', p:488},{n:65, s:'Ø§Ù„Ø·Ù„Ø§Ù‚', p:490},{n:66, s:'Ø§Ù„ØªØ­Ø±ÙŠÙ…', p:492},{n:67, s:'Ø§Ù„Ù…Ù„Ùƒ', p:493},{n:68, s:'Ø§Ù„Ù‚Ù„Ù…', p:495},{n:69, s:'Ø§Ù„Ø­Ø§Ù‚Ø©', p:497},{n:70, s:'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬', p:498},{n:71, s:'Ù†ÙˆØ­', p:499},{n:72, s:'Ø§Ù„Ø¬Ù†', p:500},{n:73, s:'Ø§Ù„Ù…Ø²Ù…Ù„', p:501},{n:74, s:'Ø§Ù„Ù…Ø¯Ø«Ø±', p:502},{n:75, s:'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©', p:503},{n:76, s:'Ø§Ù„Ø¥Ù†Ø³Ø§Ù†', p:504},{n:77, s:'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª', p:505},{n:78, s:'Ø§Ù„Ù†Ø¨Ø£', p:506},{n:79, s:'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª', p:507},{n:80, s:'Ø¹Ø¨Ø³', p:508},{n:81, s:'Ø§Ù„ØªÙƒÙˆÙŠØ±', p:509},{n:82, s:'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±', p:510},{n:83, s:'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†', p:511},{n:84, s:'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚', p:512},{n:85, s:'Ø§Ù„Ø¨Ø±ÙˆØ¬', p:513},{n:86, s:'Ø§Ù„Ø·Ø§Ø±Ù‚', p:514},{n:87, s:'Ø§Ù„Ø£Ø¹Ù„Ù‰', p:515},{n:88, s:'Ø§Ù„ØºØ§Ø´ÙŠØ©', p:516},{n:89, s:'Ø§Ù„ÙØ¬Ø±', p:517},{n:90, s:'Ø§Ù„Ø¨Ù„Ø¯', p:518},{n:91, s:'Ø§Ù„Ø´Ù…Ø³', p:519},{n:92, s:'Ø§Ù„Ù„ÙŠÙ„', p:520},{n:93, s:'Ø§Ù„Ø¶Ø­Ù‰', p:521},{n:94, s:'Ø§Ù„Ø´Ø±Ø­', p:522},{n:95, s:'Ø§Ù„ØªÙŠÙ†', p:523},{n:96, s:'Ø§Ù„Ø¹Ù„Ù‚', p:524},{n:97, s:'Ø§Ù„Ù‚Ø¯Ø±', p:525},{n:98, s:'Ø§Ù„Ø¨ÙŠÙ†Ø©', p:526},{n:99, s:'Ø§Ù„Ø²Ù„Ø²Ù„Ø©', p:527},{n:100, s:'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª', p:528},{n:101, s:'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©', p:529},{n:102, s:'Ø§Ù„ØªÙƒØ§Ø«Ø±', p:530},{n:103, s:'Ø§Ù„Ø¹ØµØ±', p:531},{n:104, s:'Ø§Ù„Ù‡Ù…Ø²Ø©', p:532},{n:105, s:'Ø§Ù„ÙÙŠÙ„', p:533},{n:106, s:'Ù‚Ø±ÙŠØ´', p:534},{n:107, s:'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†', p:535},{n:108, s:'Ø§Ù„ÙƒÙˆØ«Ø±', p:536},{n:109, s:'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†', p:537},{n:110, s:'Ø§Ù„Ù†ØµØ±', p:538},{n:111, s:'Ø§Ù„Ù…Ø³Ø¯', p:539},{n:112, s:'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ', p:540},{n:113, s:'Ø§Ù„ÙÙ„Ù‚', p:541},{n:114, s:'Ø§Ù„Ù†Ø§Ø³', p:542}];

  let currentPage = Number(localStorage.getItem('mushaf_page')) || 1;
  let currentVerse = null;
  let bookmarks = JSON.parse(localStorage.getItem('mushaf_bookmarks')) || {};

  async function loadPage(p) {
    if (p < 1 || p > 604) return;
    currentPage = p;
    localStorage.setItem('mushaf_page', p);
    const content = document.getElementById('mushafContent');
    content.innerHTML = '<div style="text-align:center">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
    
    try {
      const res = await fetch(`https://api.alquran.cloud/v1/page/${p}/quran-uthmani`);
      const data = await res.json();
      const ayahs = data.data.ayahs;
      
      document.getElementById('pageIdx').textContent = p;
      document.getElementById('surahName').textContent = ayahs[0].surah.name;
      
      content.innerHTML = ayahs.map(a => `
        <span class="verse" data-surah="${a.surah.number}" data-ayah="${a.numberInSurah}" data-sname="${a.surah.name}">
          ${a.text}<span class="verse-num">${a.numberInSurah}</span>
        </span>
      `).join(' ');
      
      applyMarksToUI(); // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      document.querySelector('.reader-wrap').scrollTop = 0;
    } catch(e) { content.innerHTML = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'; }
  }

  function applyMarksToUI() {
    document.querySelectorAll('.verse').forEach(v => {
      const key = `${v.dataset.surah}_${v.dataset.ayah}`;
      v.classList.remove('marked-gold', 'marked-green', 'marked-red');
      if (bookmarks[key]) v.classList.add(`marked-${bookmarks[key]}`);
    });
  }

  window.setMark = (color) => {
    if(!currentVerse) return;
    const key = `${currentVerse.surah}_${currentVerse.ayah}`;
    bookmarks[key] = color;
    localStorage.setItem('mushaf_bookmarks', JSON.stringify(bookmarks));
    applyMarksToUI();
    document.getElementById('tafsirModal').style.display = 'none';
  };

  document.getElementById('clearMarkBtn').onclick = () => {
    if(!currentVerse) return;
    const key = `${currentVerse.surah}_${currentVerse.ayah}`;
    delete bookmarks[key];
    localStorage.setItem('mushaf_bookmarks', JSON.stringify(bookmarks));
    applyMarksToUI();
    document.getElementById('tafsirModal').style.display = 'none';
  };

  window.goToPage = (p) => {
    loadPage(p);
    document.getElementById('sidebar').classList.remove('open');
  };

  document.getElementById('mushafContent').addEventListener('click', e => {
    const v = e.target.closest('.verse');
    if(!v) return;
    currentVerse = v.dataset;
    document.getElementById('tafsirTitle').textContent = `Ø³ÙˆØ±Ø© ${v.dataset.sname}`;
    document.getElementById('tafsirMeta').textContent = `Ø§Ù„Ø¢ÙŠØ© Ø±Ù‚Ù… ${v.dataset.ayah}`;
    document.getElementById('tafsirContent').innerHTML = "Ø§Ø®ØªØ± Ù…ÙØ³Ø±Ø§Ù‹ Ø£Ùˆ Ø¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø­ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ©";
    
    const ksu = document.getElementById('ksuButtons');
    ksu.innerHTML = [
      {id:'saadi', l:'Ø§Ù„Ø³Ø¹Ø¯ÙŠ'}, {id:'katheer', l:'Ø§Ø¨Ù† ÙƒØ«ÙŠØ±'}, {id:'qortobi', l:'Ø§Ù„Ù‚Ø±Ø·Ø¨ÙŠ'}
    ].map(t => `<button class="choice-btn" onclick="window.open('https://quran.ksu.edu.sa/tafseer/${t.id}/sura${v.dataset.surah}-aya${v.dataset.ayah}.html')">${t.l}</button>`).join('');
    
    document.getElementById('tafsirModal').style.display = 'flex';
  });

  document.getElementById('showLocalBtn').onclick = async () => {
    const cont = document.getElementById('tafsirContent');
    cont.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
    try {
      const r = await fetch(`https://api-quran.com/api?type=tafser2&surah=${currentVerse.surah}&ayah=${currentVerse.ayah}`);
      const d = await r.json();
      cont.innerHTML = d.result;
    } catch(e) { cont.innerHTML = "ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ±"; }
  };

  document.getElementById('openMenu').onclick = () => document.getElementById('sidebar').classList.add('open');
  document.getElementById('closeMenu').onclick = () => document.getElementById('sidebar').classList.remove('open');
  document.getElementById('tafsirClose').onclick = () => document.getElementById('tafsirModal').style.display = 'none';
  document.getElementById('nextPage').onclick = () => loadPage(currentPage + 1);
  document.getElementById('prevPage').onclick = () => loadPage(currentPage - 1);
  document.getElementById('btnRandom').onclick = () => loadPage(Math.floor(Math.random() * 604) + 1);
  document.getElementById('toggleTheme').onclick = () => document.body.classList.toggle('dark');

  // Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙÙ‡Ø±Ø³
  const toc = document.getElementById('toc');
  toc.innerHTML = SURA_TABLE.map(s => `
    <a href="#" onclick="event.preventDefault(); window.goToPage(${s.p})">
      <span>${s.n}. ${s.s}</span>
      <span style="opacity:0.6">Øµ ${s.p}</span>
    </a>
  `).join('');

  loadPage(currentPage);
})();
</script>
</body>
</html>