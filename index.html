<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />  
  <title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ â€” Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆÙ…ØªØ§Ø¨Ø¹Ø©</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f172a; --paper: #fdfbf7; --muted: #64748b; --accent: #b8862f;
      --ink: #1e293b; --radius: 20px; --shadow: 0 10px 30px rgba(0,0,0,0.3);
      --sans: 'Cairo', sans-serif; --serif: 'Amiri', serif;
    }
    .dark { --bg: #020617; --paper: #1e293b; --ink: #f1f5f9; --muted: #94a3b8; }

    body { margin: 0; background: var(--bg); font-family: var(--sans); color: var(--ink); transition: background 0.3s; }
    .app { display: flex; flex-direction: column; min-height: 100vh; }

    /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± --- */
    header.app-bar {
      padding: 12px 20px; display: flex; align-items: center; justify-content: space-between;
      background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 1000; flex-wrap: wrap; gap: 10px;
    }
    .brand { flex: 1; min-width: 120px; }
    .brand .title { font-size: 18px; font-weight: 800; color: #fff; margin: 0; }
    .brand .subtitle { font-size: 10px; color: var(--muted); }

    /* --- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡ --- */
    .reciter-select {
        background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);
        color: #fff; padding: 6px 12px; border-radius: 10px; font-family: var(--sans);
        font-size: 13px; outline: none; cursor: pointer; max-width: 150px;
    }
    .reciter-select option { background: #1e293b; color: #fff; }

    /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© --- */
    .shell { flex: 1; display: flex; overflow: hidden; position: relative; }
    .reader-wrap { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; scroll-behavior: smooth; touch-action: pan-y; }

    .mushaf-card {
      background: var(--paper); border-radius: var(--radius); padding: 40px 25px;
      box-shadow: var(--shadow); max-width: 800px; margin: 20px auto; min-height: 80vh;
      direction: rtl; position: relative;
    }

    .location-hint { font-size: 13px; color: var(--muted); text-align: center; margin-bottom: 8px; }

    /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø³ÙˆØ±Ø© --- */
    .surah-block { margin-top: 30px; margin-bottom: 20px; text-align: center; clear: both; display: block; width: 100%; }
    
    .surah-name-frame {
      display: inline-block; border: 2px solid var(--accent); border-radius: 8px;
      padding: 8px 30px; font-family: var(--serif); font-size: 24px; font-weight: bold;
      color: var(--accent); background: rgba(184, 134, 47, 0.08); margin-bottom: 15px;
    }

    .basmalah-decorated {
      font-family: var(--serif); font-size: 28px; color: var(--ink);
      margin: 10px 0 25px 0; display: flex; align-items: center; justify-content: center;
      gap: 15px; opacity: 0.9;
    }
    .basmalah-decorated::before, .basmalah-decorated::after {
      content: "Û"; color: var(--accent); font-size: 22px;
    }

    /* --- ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± --- */
    button {
      cursor: pointer; font-family: inherit; border: none; outline: none;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative; overflow: hidden; -webkit-tap-highlight-color: transparent;
    }
    button:active { transform: scale(0.94); }

    .btn, .btn-icon {
      background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.08);
      color: #fff; border-radius: 12px; padding: 8px 16px; font-size: 14px; font-weight: 600;
      backdrop-filter: blur(4px); display: inline-flex; align-items: center; justify-content: center; height: 40px;
    }
    .btn-icon { width: 40px; padding: 0; font-size: 18px; }
    .btn:hover, .btn-icon:hover {
      background: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); transform: translateY(-2px);
    }

    .play-surah {
      width: 42px; height: 42px; border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #d49a3f);
      color: #fff; font-size: 16px; box-shadow: 0 4px 15px rgba(184, 134, 47, 0.3);
      display: inline-flex; align-items: center; justify-content: center; margin-left: 10px; vertical-align: middle;
    }
    .play-surah:hover { transform: scale(1.1) rotate(5deg); box-shadow: 0 6px 20px rgba(184, 134, 47, 0.5); }
    .play-surah.small { width: 32px; height: 32px; font-size: 12px; box-shadow: none; background: var(--accent); }

    /* --- Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ --- */
    .page-text { 
      font-family: var(--serif); font-size: 26px; line-height: 2.3; 
      text-align: justify; text-align-last: center; display: block;
    }

    .verse { cursor: pointer; padding: 4px 0; border-radius: 6px; transition: 0.2s; display: inline; }
    .verse:hover { background: rgba(184, 134, 47, 0.06); }
    
    /* Highlight Styles */
    .verse.marked-gold { background: rgba(184, 134, 47, 0.15); border-bottom: 2px solid #b8862f; }
    .verse.marked-green { background: rgba(16, 185, 129, 0.15); border-bottom: 2px solid #10b981; }
    .verse.marked-red { background: rgba(239, 68, 68, 0.15); border-bottom: 2px solid #ef4444; }

    /* ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© */
    .verse.playing-verse {
      background-color: rgba(184, 134, 47, 0.3) !important;
      box-shadow: 0 0 0 2px rgba(184, 134, 47, 0.4);
      border-radius: 6px; color: var(--ink);
    }

    .verse-num {
      font-family: var(--sans); font-size: 14px; color: var(--accent); font-weight: bold;
      margin: 0 6px; display: inline-flex; width: 30px; height: 30px;
      border: 1px solid var(--accent); border-radius: 50%; align-items: center; justify-content: center;
    }

    /* --- Sidebar & Modal --- */
    .sidebar {
      position: fixed; right: -100%; top: 0; bottom: 0; width: 85%; max-width: 320px;
      background: var(--bg); z-index: 2000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 20px; display: flex; flex-direction: column; box-shadow: -10px 0 30px rgba(0,0,0,0.5);
    }
    .sidebar.open { right: 0; }
    
    .toc { flex: 1; overflow-y: auto; margin-top: 20px; padding-right: 5px; }
    .toc a {
      display: flex; justify-content: space-between; padding: 14px;
      background: rgba(255,255,255,0.05); margin-bottom: 8px; border-radius: 12px;
      text-decoration: none; color: #fff; font-size: 14px; border: 1px solid rgba(255,255,255,0.05);
    }

    .tafsir-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: flex-end; justify-content: center; z-index: 3000; }
    .tafsir-panel { background: var(--paper); width: 100%; max-width: 600px; border-radius: 30px 30px 0 0; padding: 25px; max-height: 80vh; overflow-y: auto; }
    
    .choice-btn {
      background: var(--paper); color: var(--ink); border: 1px solid rgba(128, 128, 128, 0.15);
      padding: 14px; border-radius: 14px; font-weight: 700; font-size: 14px; text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); width: 100%;
    }
    .choice-btn:hover {
      border-color: var(--accent); background: rgba(184, 134, 47, 0.05);
      transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .choice-btn[style*="background:var(--accent)"] {
      background: linear-gradient(135deg, var(--accent), #b38028) !important;
      color: #fff !important; box-shadow: 0 5px 15px rgba(184, 134, 47, 0.3) !important; border: none !important;
    }
    .choice-btn[style*="background:var(--accent)"]:hover {
      filter: brightness(1.1); transform: translateY(-2px) scale(1.01);
    }

    .mark-tools { display: flex; align-items: center; gap: 12px; margin: 15px 0; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 12px; }
    .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; }
    
    #clearMarkBtn {
      background: transparent !important; border: 1px solid var(--muted) !important; color: var(--muted) !important;
      border-radius: 6px; padding: 4px 10px !important; font-size: 11px; font-weight: bold; transition: 0.2s;
    }
    #clearMarkBtn:hover { background: rgba(239, 68, 68, 0.1) !important; border-color: #ef4444 !important; color: #ef4444 !important; }

    #tafsirClose { background: rgba(128, 128, 128, 0.1) !important; color: var(--ink); transition: 0.2s; }
    #tafsirClose:hover { background: rgba(239, 68, 68, 0.1) !important; color: #ef4444; transform: rotate(90deg); }

    #closeMenu {
      background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.05); margin-top: 20px !important;
    }
    #closeMenu:hover { background: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.5); color: #fff; }

    /* Responsive */
    @media (max-width: 767px) {
      .app-bar { padding: 10px 15px; }
      .reader-wrap { padding: 10px; }
      .mushaf-card { background: transparent; box-shadow: none; border-radius: 8px; padding: 6px 6px 40px 6px; margin: 0; min-height: auto; max-width: none; }
      .page-text { font-size: 20px; line-height: 2.1; text-align: right; display: grid; grid-template-columns: 1fr; gap: 8px; }
      .verse { display: block; padding: 12px 14px; background: rgba(255,255,255,0.02); border-radius: 12px; margin: 0; font-size: 20px; }
      .verse-num { float: left; margin-left: 8px; }
    }
    @media (min-width: 768px) {
      .sidebar { position: static; right: 0; width: 350px; margin: 15px; border-radius: 20px; }
      .tafsir-modal { align-items: center; padding: 20px; }
      .tafsir-panel { border-radius: 25px; }
    }
    :root {
      /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØµØ¨Ø§Ø­ÙŠ */
      --bg: #f0f2f5; 
      --paper: #ffffff; 
      --muted: #64748b; 
      --accent: #b8862f;
      --ink: #1e293b; 
      --radius: 20px; 
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --sans: 'Cairo', sans-serif; 
      --serif: 'Amiri', serif;
      --header-bg: rgba(255, 255, 255, 0.8);
      --header-text: #1e293b;
    }

    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
    body.dark { 
      --bg: #0f172a; 
      --paper: #1e293b; 
      --ink: #f1f5f9; 
      --muted: #94a3b8; 
      --shadow: 0 10px 30px rgba(0,0,0,0.5);
      --header-bg: rgba(15, 23, 42, 0.8);
      --header-text: #ffffff;
    }

    body { 
      margin: 0; 
      background: var(--bg); 
      font-family: var(--sans); 
      color: var(--ink); 
      transition: background 0.3s, color 0.3s; 
    }

    header.app-bar {
      padding: 12px 20px; 
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      background: var(--header-bg); 
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(128,128,128,0.1); 
      z-index: 1000; 
      position: sticky;
      top: 0;
    }
    
    .brand .title { color: var(--header-text); }
    
  </style>

  <style>
  :root {
    /* Ø£Ù„ÙˆØ§Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø± (Ø§Ù„ØµØ¨Ø§Ø­ÙŠ) */
    --bg: #f8fafc; 
    --paper: #ffffff; 
    --muted: #64748b; 
    --accent: #b8862f;
    --ink: #1e293b; 
    --radius: 20px; 
    --shadow: 0 10px 40px rgba(0,0,0,0.06);
    --sans: 'Cairo', sans-serif; 
    --serif: 'Amiri', serif;
    --header-bg: rgba(255, 255, 255, 0.9);
    --btn-bg: rgba(0, 0, 0, 0.05); /* Ø²Ø± Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ */
    --btn-text: #1e293b;         /* Ù†Øµ Ø§Ù„Ø²Ø± Ø£Ø³ÙˆØ¯ */
    --border: rgba(0, 0, 0, 0.1);
  }

  body.dark { 
    /* Ø£Ù„ÙˆØ§Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ */
    --bg: #000; 
    --paper: #18181B; 
    --ink: #f1f5f9; 
    --muted: #ffffff; 
    --shadow: 0 10px 40px rgb(0, 0, 0);
    --header-bg: rgba(15, 23, 42, 0.9);
    --btn-bg: rgba(255, 255, 255, 0.1); /* Ø²Ø± Ø´ÙØ§Ù Ø£Ø¨ÙŠØ¶ */
    --btn-text: #ffffff;             /* Ù†Øµ Ø§Ù„Ø²Ø± Ø£Ø¨ÙŠØ¶ */
    --border: rgba(255, 255, 255, 0.1);
  }

  body { margin: 0; background: var(--bg); font-family: var(--sans); color: var(--ink); transition: 0.3s; }

  /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
  header.app-bar {
    padding: 12px 20px; display: flex; align-items: center; justify-content: space-between;
    background: var(--header-bg); backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000;
  }
  .brand .title { color: var(--ink); font-size: 18px; margin: 0; }

  /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© */
  .btn, .btn-icon, .reciter-select {
    background: var(--btn-bg); border: 1px solid var(--border);
    color: var(--btn-text); border-radius: 12px; cursor: pointer;
    transition: 0.2s; font-family: var(--sans);
  }
  .btn-icon { width: 40px; height: 40px; font-size: 18px; display: flex; align-items: center; justify-content: center; }
  .btn:hover, .btn-icon:hover { background: var(--accent); color: white; }

  /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØµØ­Ù */
  .mushaf-card {
    background: var(--paper); border-radius: var(--radius); padding: 40px 25px;
    box-shadow: var(--shadow); max-width: 800px; margin: 20px auto; color: var(--ink);
  }

  /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
  .sidebar { background: var(--paper); color: var(--ink); box-shadow: -10px 0 30px var(--shadow); }
  .toc a { background: var(--btn-bg); color: var(--ink); text-decoration: none; }

  /* Ø§Ù„ØªÙØ³ÙŠØ± */
  .tafsir-panel { background: var(--paper); color: var(--ink); }
  .choice-btn { background: var(--btn-bg); color: var(--ink); border: 1px solid var(--border); cursor: pointer; }
</style>
</head>
<body class="dark">

<div class="app">
  <header class="app-bar">
    <div class="brand">
      <h1 class="title">Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ</h1>
      <div class="subtitle">Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆÙ…ØªØ§Ø¨Ø¹Ø©</div>
    </div>
    
    <select id="reciterSelect" class="reciter-select"></select>

    <div style="display:flex; gap:8px; align-items:center;">
      <button class="btn-icon" id="toggleTheme">ğŸŒ“</button>
      <button class="btn" id="btnRandom" title="ÙØªØ­ ØµÙØ­Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©">ğŸ²</button>
            <button class="btn" title="ÙØªØ­ ØµÙØ­Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©"><a href="a.html" style="color: white; text-decoration: none;">ğŸ” Ø§Ù„Ø¨Ø§Ø­Ø« Ø§Ù„Ù‚Ø±Ø§Ù†ÙŠ</a></button>

      <button class="btn" id="openMenu">â˜°</button>
    </div>
  </header>

  <div class="shell">
    <main class="reader-wrap" id="readerWrap">
      <div class="mushaf-card" id="mushafCard">
        <div id="pageMeta" style="text-align: center; color: var(--muted); font-size: 13px; margin-bottom: 6px;">
          ØµÙØ­Ø© <span id="pageIdx">1</span>
        </div>
        <div id="locationHint" class="location-hint"></div>
        <article id="mushafContent" class="page-text">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</article>
      </div>
    </main>

    <aside class="sidebar" id="sidebar">
      <h2 style="color:#fff; margin-bottom:15px;">ÙÙ‡Ø±Ø³ Ø§Ù„Ø³ÙˆØ±</h2>
      <div class="toc" id="toc"></div>
      <button id="closeMenu" class="btn" style="width:100%">Ø¥ØºÙ„Ø§Ù‚</button>
    </aside>
  </div>
</div>

<audio id="surahAudio" preload="auto"></audio>

<div id="tafsirModal" class="tafsir-modal">
  <div class="tafsir-panel">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 id="tafsirTitle" style="margin:0; color:var(--accent);">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¢ÙŠØ©</h3>
      <button id="tafsirClose" style="border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">âœ•</button>
    </div>
    <p id="tafsirMeta" style="color:var(--muted); font-size:14px; margin:10px 0;"></p>

    <div class="mark-tools">
      <span style="font-size:13px; font-weight:bold;">Ø¹Ù„Ø§Ù…Ø©:</span>
      <div class="color-dot" style="background:#b8862f" onclick="setMark('gold')"></div>
      <div class="color-dot" style="background:#10b981" onclick="setMark('green')"></div>
      <div class="color-dot" style="background:#ef4444" onclick="setMark('red')"></div>
      <button id="clearMarkBtn">Ø­Ø°Ù</button>
    </div>

    <div style="display:grid; grid-template-columns: 1fr; gap:10px; margin-bottom:15px;" id="ksuButtons"></div>
    
    <div id="tafsirContent" style="background:rgba(0,0,0,0.03); padding:15px; border-radius:15px; line-height:1.8; font-size:17px; font-family:var(--serif);"></div>
  </div>
</div>
<script>
  // ÙƒÙˆØ¯ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… Ù…Ø¹ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
  const toggleBtn = document.getElementById('toggleTheme');
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø³Ø§Ø¨Ù‚Ø§Ù‹
  if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
  }

  toggleBtn.onclick = () => {
    document.body.classList.toggle('dark');
    // Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„
    if (document.body.classList.contains('dark')) {
        localStorage.setItem('theme', 'dark');
    } else {
        localStorage.setItem('theme', 'light');
    }
  };
</script>
<script>
(function(){
const TOTAL_PAGES = 604;

const SURA_TABLE = [
    {n:1, s:'Ø§Ù„ÙØ§ØªØ­Ø©', p:1},
    {n:2, s:'Ø§Ù„Ø¨Ù‚Ø±Ø©', p:2},
    {n:3, s:'Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†', p:50},
    {n:4, s:'Ø§Ù„Ù†Ø³Ø§Ø¡', p:77},
    {n:5, s:'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©', p:106},
    {n:6, s:'Ø§Ù„Ø£Ù†Ø¹Ø§Ù…', p:128},
    {n:7, s:'Ø§Ù„Ø£Ø¹Ø±Ø§Ù', p:151},
    {n:8, s:'Ø§Ù„Ø£Ù†ÙØ§Ù„', p:177},
    {n:9, s:'Ø§Ù„ØªÙˆØ¨Ø©', p:187},
    {n:10, s:'ÙŠÙˆÙ†Ø³', p:208},
    {n:11, s:'Ù‡ÙˆØ¯', p:221},
    {n:12, s:'ÙŠÙˆØ³Ù', p:234},
    {n:13, s:'Ø§Ù„Ø±Ø¹Ø¯', p:249},
    {n:14, s:'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…', p:255},
    {n:15, s:'Ø§Ù„Ø­Ø¬Ø±', p:262},
    {n:16, s:'Ø§Ù„Ù†Ø­Ù„', p:267},
    {n:17, s:'Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡', p:282},
    {n:18, s:'Ø§Ù„ÙƒÙ‡Ù', p:293},
    {n:19, s:'Ù…Ø±ÙŠÙ…', p:305},
    {n:20, s:'Ø·Ù‡', p:312},
    {n:21, s:'Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡', p:322},
    {n:22, s:'Ø§Ù„Ø­Ø¬', p:332},
    {n:23, s:'Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†', p:342},
    {n:24, s:'Ø§Ù„Ù†ÙˆØ±', p:350},
    {n:25, s:'Ø§Ù„ÙØ±Ù‚Ø§Ù†', p:359},
    {n:26, s:'Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡', p:367},
    {n:27, s:'Ø§Ù„Ù†Ù…Ù„', p:377},
    {n:28, s:'Ø§Ù„Ù‚ØµØµ', p:385},
    {n:29, s:'Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª', p:396},
    {n:30, s:'Ø§Ù„Ø±ÙˆÙ…', p:404},
    {n:31, s:'Ù„Ù‚Ù…Ø§Ù†', p:411},
    {n:32, s:'Ø§Ù„Ø³Ø¬Ø¯Ø©', p:415},
    {n:33, s:'Ø§Ù„Ø£Ø­Ø²Ø§Ø¨', p:418},
    {n:34, s:'Ø³Ø¨Ø£', p:428},
    {n:35, s:'ÙØ§Ø·Ø±', p:434},
    {n:36, s:'ÙŠØ³', p:440},
    {n:37, s:'Ø§Ù„ØµØ§ÙØ§Øª', p:446},
    {n:38, s:'Øµ', p:453},
    {n:39, s:'Ø§Ù„Ø²Ù…Ø±', p:458},
    {n:40, s:'ØºØ§ÙØ±', p:467},
    {n:41, s:'ÙØµÙ„Øª', p:477},
    {n:42, s:'Ø§Ù„Ø´ÙˆØ±Ù‰', p:483},
    {n:43, s:'Ø§Ù„Ø²Ø®Ø±Ù', p:489},
    {n:44, s:'Ø§Ù„Ø¯Ø®Ø§Ù†', p:496},
    {n:45, s:'Ø§Ù„Ø¬Ø§Ø«ÙŠØ©', p:499},
    {n:46, s:'Ø§Ù„Ø£Ø­Ù‚Ø§Ù', p:502},
    {n:47, s:'Ù…Ø­Ù…Ø¯', p:507},
    {n:48, s:'Ø§Ù„ÙØªØ­', p:511},
    {n:49, s:'Ø§Ù„Ø­Ø¬Ø±Ø§Øª', p:515},
    {n:50, s:'Ù‚', p:518},
    {n:51, s:'Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª', p:520},
    {n:52, s:'Ø§Ù„Ø·ÙˆØ±', p:523},
    {n:53, s:'Ø§Ù„Ù†Ø¬Ù…', p:526},
    {n:54, s:'Ø§Ù„Ù‚Ù…Ø±', p:528},
    {n:55, s:'Ø§Ù„Ø±Ø­Ù…Ù†', p:531},
    {n:56, s:'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©', p:534},
    {n:57, s:'Ø§Ù„Ø­Ø¯ÙŠØ¯', p:537},
    {n:58, s:'Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©', p:542},
    {n:59, s:'Ø§Ù„Ø­Ø´Ø±', p:545},
    {n:60, s:'Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©', p:549},
    {n:61, s:'Ø§Ù„ØµÙ', p:551},
    {n:62, s:'Ø§Ù„Ø¬Ù…Ø¹Ø©', p:553},
    {n:63, s:'Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†', p:554},
    {n:64, s:'Ø§Ù„ØªØºØ§Ø¨Ù†', p:556},
    {n:65, s:'Ø§Ù„Ø·Ù„Ø§Ù‚', p:558},
    {n:66, s:'Ø§Ù„ØªØ­Ø±ÙŠÙ…', p:560},
    {n:67, s:'Ø§Ù„Ù…Ù„Ùƒ', p:562},
    {n:68, s:'Ø§Ù„Ù‚Ù„Ù…', p:564},
    {n:69, s:'Ø§Ù„Ø­Ø§Ù‚Ø©', p:566},
    {n:70, s:'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬', p:568},
    {n:71, s:'Ù†ÙˆØ­', p:570},
    {n:72, s:'Ø§Ù„Ø¬Ù†', p:572},
    {n:73, s:'Ø§Ù„Ù…Ø²Ù…Ù„', p:574},
    {n:74, s:'Ø§Ù„Ù…Ø¯Ø«Ø±', p:575},
    {n:75, s:'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©', p:577},
    {n:76, s:'Ø§Ù„Ø¥Ù†Ø³Ø§Ù†', p:578},
    {n:77, s:'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª', p:580},
    {n:78, s:'Ø§Ù„Ù†Ø¨Ø£', p:582},
    {n:79, s:'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª', p:583},
    {n:80, s:'Ø¹Ø¨Ø³', p:585},
    {n:81, s:'Ø§Ù„ØªÙƒÙˆÙŠØ±', p:586},
    {n:82, s:'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±', p:587},
    {n:83, s:'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†', p:587},
    {n:84, s:'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚', p:589},
    {n:85, s:'Ø§Ù„Ø¨Ø±ÙˆØ¬', p:590},
    {n:86, s:'Ø§Ù„Ø·Ø§Ø±Ù‚', p:591},
    {n:87, s:'Ø§Ù„Ø£Ø¹Ù„Ù‰', p:591},
    {n:88, s:'Ø§Ù„ØºØ§Ø´ÙŠØ©', p:592},
    {n:89, s:'Ø§Ù„ÙØ¬Ø±', p:593},
    {n:90, s:'Ø§Ù„Ø¨Ù„Ø¯', p:594},
    {n:91, s:'Ø§Ù„Ø´Ù…Ø³', p:595},
    {n:92, s:'Ø§Ù„Ù„ÙŠÙ„', p:595},
    {n:93, s:'Ø§Ù„Ø¶Ø­Ù‰', p:596},
    {n:94, s:'Ø§Ù„Ø´Ø±Ø­', p:596},
    {n:95, s:'Ø§Ù„ØªÙŠÙ†', p:597},
    {n:96, s:'Ø§Ù„Ø¹Ù„Ù‚', p:597},
    {n:97, s:'Ø§Ù„Ù‚Ø¯Ø±', p:598},
    {n:98, s:'Ø§Ù„Ø¨ÙŠÙ†Ø©', p:598},
    {n:99, s:'Ø§Ù„Ø²Ù„Ø²Ù„Ø©', p:599},
    {n:100, s:'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª', p:599},
    {n:101, s:'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©', p:600},
    {n:102, s:'Ø§Ù„ØªÙƒØ§Ø«Ø±', p:600},
    {n:103, s:'Ø§Ù„Ø¹ØµØ±', p:601},
    {n:104, s:'Ø§Ù„Ù‡Ù…Ø²Ø©', p:601},
    {n:105, s:'Ø§Ù„ÙÙŠÙ„', p:601},
    {n:106, s:'Ù‚Ø±ÙŠØ´', p:602},
    {n:107, s:'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†', p:602},
    {n:108, s:'Ø§Ù„ÙƒÙˆØ«Ø±', p:602},
    {n:109, s:'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†', p:603},
    {n:110, s:'Ø§Ù„Ù†ØµØ±', p:603},
    {n:111, s:'Ø§Ù„Ù…Ø³Ø¯', p:603},
    {n:112, s:'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ', p:604},
    {n:113, s:'Ø§Ù„ÙÙ„Ù‚', p:604},
    {n:114, s:'Ø§Ù„Ù†Ø§Ø³', p:604}
  ];

  let currentPage = Number(localStorage.getItem('mushaf_page')) || 1;
  let currentVerse = null;
  let bookmarks = JSON.parse(localStorage.getItem('mushaf_bookmarks')) || {};

  // --- ØªØ¹Ø±ÙŠÙ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡ ---
  const RECITERS = [
      { id: 'alafasy', name: 'Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ', surahServer: 'https://server8.mp3quran.net/afs/', ayahServer: 'Alafasy_128kbps' },
      { id: 'ajmi', name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø¬Ù…ÙŠ', surahServer: 'https://server10.mp3quran.net/ajm/', ayahServer: 'Ahmed_ibn_Ali_al-Ajamy_128kbps' },
      { id: 'minshawy', name: 'Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ', surahServer: 'https://server10.mp3quran.net/minsh/', ayahServer: 'Minshawy_Murattal_128kbps' },
      { id: 'wadee', name: 'ÙˆØ¯ÙŠØ¹ Ø§Ù„ÙŠÙ…Ù†ÙŠ', surahServer: 'https://server6.mp3quran.net/wdee3/', ayahServer: 'Alafasy_128kbps' },
      { id: 'husary', name: 'Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ', surahServer: 'https://server13.mp3quran.net/husr/', ayahServer: 'Husary_128kbps' },
      { id: 'yasser', name: 'ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', surahServer: 'https://server11.mp3quran.net/yasser/', ayahServer: 'Yasser_Ad-Dussary_128kbps' },
      { id: 'jaber', name: 'Ø¹Ù„ÙŠ Ø¬Ø§Ø¨Ø±', surahServer: 'https://server11.mp3quran.net/a_jbr/', ayahServer: 'Ali_Jaber_64kbps' }
  ];

  let savedReciterId = localStorage.getItem('mushaf_reciter') || 'alafasy';
  let activeReciter = RECITERS.find(r => r.id === savedReciterId) || RECITERS[0];

  const reciterSelect = document.getElementById('reciterSelect');
  RECITERS.forEach(r => {
      const opt = document.createElement('option');
      opt.value = r.id;
      opt.textContent = r.name;
      if(r.id === activeReciter.id) opt.selected = true;
      reciterSelect.appendChild(opt);
  });

  reciterSelect.addEventListener('change', (e) => {
      const selectedId = e.target.value;
      activeReciter = RECITERS.find(r => r.id === selectedId);
      localStorage.setItem('mushaf_reciter', selectedId);
      surahAudio.pause();
      isVersePlaying = false;
      activeSurahPlaying = null;
      if(activePlayButton) activePlayButton.textContent = 'ğŸ”Š';
      activePlayButton = null;
      document.querySelectorAll('.playing-verse').forEach(el => el.classList.remove('playing-verse'));
  });

  const surahAudio = document.getElementById('surahAudio');
  let activePlayButton = null;
  let activeSurahPlaying = null;
  let isVersePlaying = false;
  let currentPlayingSurah = 0;
  let currentPlayingAyah = 0;

  function pad3(num) {
    return String(Number(num)).padStart(3, '0');
  }

  // --- Page Loading ---
  async function loadPage(p) {
    if (p < 1 || p > 604) return;
    currentPage = p;
    localStorage.setItem('mushaf_page', p);
    const content = document.getElementById('mushafContent');
    content.innerHTML = '<div style="text-align:center; padding:50px;">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...</div>';
    document.getElementById('locationHint').textContent = '';
    
    try {
      const res = await fetch(`https://api.alquran.cloud/v1/page/${p}/quran-uthmani`);
      const data = await res.json();
      const ayahs = data.data.ayahs;
      
      document.getElementById('pageIdx').textContent = p;
      if (ayahs && ayahs.length) {
        const surahStarts = ayahs.filter(a => a.numberInSurah === 1).map(a => a.surah.name);
        const visibleSurah = surahStarts.length ? surahStarts[0] : ayahs[0].surah.name;
        document.getElementById('locationHint').textContent = `Ø³ÙˆØ±Ø© ${visibleSurah} â€” ØµÙØ­Ø© ${p}`;
      }
      
      let htmlOutput = "";
      
      // Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø«Ù…Ø§Ù†ÙŠ Ù„Ù„Ø¨Ø³Ù…Ù„Ø© Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ù„Ø­Ø°Ù
      const uthmaniBasmalah = "Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ù±Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù";

      ayahs.forEach(a => {
        let text = a.text;
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³ÙˆØ±Ø©
        if (a.numberInSurah === 1) {
          htmlOutput += `
            <div class="surah-block">
              <div class="surah-name-frame">
                <span>Ø³ÙˆØ±Ø© ${a.surah.name}</span>
                <button class="play-surah small" data-surah="${a.surah.number}">ğŸ”Š</button>
              </div>
            </div>`;
          
          // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„ÙØ§ØªØ­Ø© (1) ÙˆÙ„Ø§ Ø§Ù„ØªÙˆØ¨Ø© (9)
          if (a.surah.number !== 1 && a.surah.number !== 9) {
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø³Ù…Ù„Ø© Ø§Ù„Ù…Ø²Ø®Ø±ÙØ©
            htmlOutput += `<div class="basmalah-decorated">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ù±Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù</div>`;
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ: Ø­Ø°Ù Ø§Ù„Ø¨Ø³Ù…Ù„Ø© Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¢ÙŠØ© Ù„Ø¹Ø±Ø¶ "Ø§Ù„Ù…" ÙÙ‚Ø·
            if (text.startsWith(uthmaniBasmalah)) {
                text = text.substring(uthmaniBasmalah.length).trim();
            }
          }
        }
        
        htmlOutput += `
          <span class="verse" 
                id="verse-${a.surah.number}-${a.numberInSurah}"
                data-surah="${a.surah.number}" 
                data-ayah="${a.numberInSurah}" 
                data-sname="${a.surah.name}">
            ${text} <span class="verse-num">${a.numberInSurah}</span>
          </span>`;
      });
      
      content.innerHTML = htmlOutput;
      applyMarksToUI();
      
      if (isVersePlaying) highlightPlayingVerse(currentPlayingSurah, currentPlayingAyah);
      document.querySelector('.reader-wrap').scrollTop = 0;
      
    } catch(e) { 
      console.error(e);
      content.innerHTML = '<div style="text-align:center; color:red">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„</div>'; 
    }
  }

  // --- Marks Logic ---
  function applyMarksToUI() {
    document.querySelectorAll('.verse').forEach(v => {
      const key = `${v.dataset.surah}_${v.dataset.ayah}`;
      v.classList.remove('marked-gold', 'marked-green', 'marked-red');
      if (bookmarks[key]) v.classList.add(`marked-${bookmarks[key]}`);
    });
  }

  window.setMark = (color) => {
    if(!currentVerse) return;
    const key = `${currentVerse.surah}_${currentVerse.ayah}`;
    bookmarks[key] = color;
    localStorage.setItem('mushaf_bookmarks', JSON.stringify(bookmarks));
    applyMarksToUI();
    document.getElementById('tafsirModal').style.display = 'none';
  };

  document.getElementById('clearMarkBtn').onclick = () => {
    if(!currentVerse) return;
    const key = `${currentVerse.surah}_${currentVerse.ayah}`;
    delete bookmarks[key];
    localStorage.setItem('mushaf_bookmarks', JSON.stringify(bookmarks));
    applyMarksToUI();
    document.getElementById('tafsirModal').style.display = 'none';
  };

  // --- Audio Playback Logic ---
  
  function highlightPlayingVerse(surah, ayah) {
    document.querySelectorAll('.playing-verse').forEach(el => el.classList.remove('playing-verse'));
    const verseEl = document.getElementById(`verse-${surah}-${ayah}`);
    if (verseEl) {
        verseEl.classList.add('playing-verse');
        verseEl.scrollIntoView({behavior: "smooth", block: "center"});
    }
  }

  // ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚ÙØ² (basmalahJump) Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ù‡Ù†Ø§ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙØ±
  surahAudio.onloadedmetadata = () => {
     // Ø§Ù„Ù…Ù„Ù Ø³ÙŠØ¹Ù…Ù„ Ù…Ù† Ø¨Ø¯Ø§ÙŠØªÙ‡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (0:00)
  };

  window.playVerseSequence = (surah, ayah) => {
    if(activeSurahPlaying) {
        surahAudio.pause();
        if(activePlayButton) activePlayButton.textContent = 'ğŸ”Š';
        activeSurahPlaying = null;
    }

    isVersePlaying = true;
    currentPlayingSurah = Number(surah);
    currentPlayingAyah = Number(ayah);
    
    document.getElementById('tafsirModal').style.display = 'none';
    highlightPlayingVerse(currentPlayingSurah, currentPlayingAyah);

    const url = `https://everyayah.com/data/${activeReciter.ayahServer}/${pad3(currentPlayingSurah)}${pad3(currentPlayingAyah)}.mp3`;

    surahAudio.src = url;
    surahAudio.currentTime = 0; // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    surahAudio.play().catch(e => { console.error("Audio play failed", e); });

    surahAudio.onended = () => {
          playVerseSequence(currentPlayingSurah, currentPlayingAyah + 1);
    };
    
    surahAudio.onerror = () => {
          if (currentPlayingSurah < 114) {
              playVerseSequence(currentPlayingSurah + 1, 1);
          } else {
              isVersePlaying = false;
              document.querySelectorAll('.playing-verse').forEach(el => el.classList.remove('playing-verse'));
              alert('ØªÙ… Ø®ØªÙ… Ø§Ù„Ù…ØµØ­Ù.');
          }
    };
  };

  // --- Interaction ---
  document.getElementById('mushafContent').addEventListener('click', e => {
    const v = e.target.closest('.verse');
    if(!v) return;
    currentVerse = v.dataset;
    
    document.getElementById('tafsirTitle').textContent = `Ø³ÙˆØ±Ø© ${v.dataset.sname}`;
    document.getElementById('tafsirMeta').textContent = `Ø§Ù„Ø¢ÙŠØ© ${v.dataset.ayah}`;
    document.getElementById('tafsirContent').innerHTML = "Ø§Ø®ØªØ± Ø®ÙŠØ§Ø±Ø§Ù‹...";
    
    const ksu = document.getElementById('ksuButtons');
    ksu.innerHTML = `
      <button class="choice-btn" style="background:var(--accent); color:#fff; font-size:15px; grid-column:1/-1;" 
              onclick="playVerseSequence(${v.dataset.surah}, ${v.dataset.ayah})">
        â–¶ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢ÙŠØ© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
      </button>
      <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; width:100%;">
        ${[
          {id:'saadi', l:'Ø§Ù„Ø³Ø¹Ø¯ÙŠ'}, {id:'katheer', l:'Ø§Ø¨Ù† ÙƒØ«ÙŠØ±'}, {id:'qortobi', l:'Ø§Ù„Ù‚Ø±Ø·Ø¨ÙŠ'}
        ].map(t => `
          <button class="choice-btn" style="background:rgba(255,255,255,0.1);" 
            onclick="window.open('https://quran.ksu.edu.sa/tafseer/${t.id}/sura${v.dataset.surah}-aya${v.dataset.ayah}.html')">
            ${t.l}
          </button>
        `).join('')}
      </div>
    `;
    
    fetch(`https://api-quran.com/api?type=tafser2&surah=${v.dataset.surah}&ayah=${v.dataset.ayah}`)
      .then(r => r.json())
      .then(d => document.getElementById('tafsirContent').innerHTML = d.result || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ³ÙŠØ± Ù…ØªØ§Ø­")
      .catch(() => document.getElementById('tafsirContent').innerHTML = "ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙØ§Ø³ÙŠØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ø£Ø¹Ù„Ø§Ù‡");

    document.getElementById('tafsirModal').style.display = 'flex';
  });

  window.goToPage = (p) => { loadPage(p); document.getElementById('sidebar').classList.remove('open'); };
  document.getElementById('openMenu').onclick = () => document.getElementById('sidebar').classList.add('open');
  document.getElementById('closeMenu').onclick = () => document.getElementById('sidebar').classList.remove('open');
  document.getElementById('tafsirClose').onclick = () => document.getElementById('tafsirModal').style.display = 'none';
  document.getElementById('toggleTheme').onclick = () => document.body.classList.toggle('dark');
  document.getElementById('btnRandom').onclick = () => loadPage(Math.floor(Math.random() * 604) + 1);

  document.getElementById('toc').innerHTML = SURA_TABLE.map(s => `
    <a href="#" onclick="event.preventDefault(); window.goToPage(${s.p})">
      <span>${s.n}. ${s.s}</span><span style="opacity:0.6">Øµ ${s.p}</span>
    </a>
  `).join('');

  loadPage(currentPage);

  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.play-surah');
    if (!btn) return;
    const surahNum = btn.dataset.surah;
    
    if(isVersePlaying) {
        isVersePlaying = false;
        document.querySelectorAll('.playing-verse').forEach(el => el.classList.remove('playing-verse'));
        surahAudio.pause();
        surahAudio.onended = null; 
        surahAudio.onerror = null;
    }

    if (activeSurahPlaying === surahNum) {
      if (surahAudio.paused) { surahAudio.play(); btn.textContent = 'â¸'; }
      else { surahAudio.pause(); btn.textContent = 'ğŸ”Š'; }
      return;
    }

    if (activePlayButton && activePlayButton !== btn) activePlayButton.textContent = 'ğŸ”Š';
    activePlayButton = btn; activeSurahPlaying = surahNum;

    surahAudio.onended = () => { if (activePlayButton) activePlayButton.textContent = 'ğŸ”Š'; activeSurahPlaying = null; };
    
    surahAudio.src = `${activeReciter.surahServer}${pad3(surahNum)}.mp3`;
    surahAudio.currentTime = 0;
    surahAudio.play().then(() => btn.textContent = 'â¸').catch(err => { console.warn(err); btn.textContent = 'ğŸ”Š'; });
  });

  const reader = document.getElementById('readerWrap');
  let startX = 0, startY = 0, isPointerDown = false;
  reader.addEventListener('touchstart', (ev) => {
    if (!ev.touches.length) return;
    startX = ev.touches[0].clientX; startY = ev.touches[0].clientY; isPointerDown = true;
  }, {passive: true});
  reader.addEventListener('touchend', (ev) => {
    if (!isPointerDown) return; isPointerDown = false;
    const t = ev.changedTouches[0];
    const dx = t.clientX - startX, dy = t.clientY - startY;
    if (Math.abs(dx) > 60 && Math.abs(dx) > Math.abs(dy)) {
      if (dx < 0) loadPage(currentPage + 1); else loadPage(currentPage - 1);
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') loadPage(currentPage - 1);
    if (e.key === 'ArrowRight') loadPage(currentPage + 1);
  });

})();
</script>
</body>
</html>    /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© --- */
    .shell { flex: 1; display: flex; overflow: hidden; position: relative; }
    .reader-wrap { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; scroll-behavior: smooth; touch-action: pan-y; }

    .mushaf-card {
      background: var(--paper); border-radius: var(--radius); padding: 40px 25px;
      box-shadow: var(--shadow); max-width: 800px; margin: 20px auto; min-height: 80vh;
      direction: rtl; position: relative;
    }

    .location-hint { font-size: 13px; color: var(--muted); text-align: center; margin-bottom: 8px; }

    /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø³ÙˆØ±Ø© --- */
    .surah-block { margin-top: 30px; margin-bottom: 20px; text-align: center; clear: both; display: block; width: 100%; }
    
    .surah-name-frame {
      display: inline-block; border: 2px solid var(--accent); border-radius: 8px;
      padding: 8px 30px; font-family: var(--serif); font-size: 24px; font-weight: bold;
      color: var(--accent); background: rgba(184, 134, 47, 0.08); margin-bottom: 15px;
    }

    .basmalah-decorated {
      font-family: var(--serif); font-size: 28px; color: var(--ink);
      margin: 10px 0 25px 0; display: flex; align-items: center; justify-content: center;
      gap: 15px; opacity: 0.9;
    }
    .basmalah-decorated::before, .basmalah-decorated::after {
      content: "Û"; color: var(--accent); font-size: 22px;
    }

    /* --- ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± --- */
    button {
      cursor: pointer; font-family: inherit; border: none; outline: none;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative; overflow: hidden; -webkit-tap-highlight-color: transparent;
    }
    button:active { transform: scale(0.94); }

    .btn, .btn-icon {
      background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.08);
      color: #fff; border-radius: 12px; padding: 8px 16px; font-size: 14px; font-weight: 600;
      backdrop-filter: blur(4px); display: inline-flex; align-items: center; justify-content: center; height: 40px;
    }
    .btn-icon { width: 40px; padding: 0; font-size: 18px; }
    .btn:hover, .btn-icon:hover {
      background: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); transform: translateY(-2px);
    }

    .play-surah {
      width: 42px; height: 42px; border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #d49a3f);
      color: #fff; font-size: 16px; box-shadow: 0 4px 15px rgba(184, 134, 47, 0.3);
      display: inline-flex; align-items: center; justify-content: center; margin-left: 10px; vertical-align: middle;
    }
    .play-surah:hover { transform: scale(1.1) rotate(5deg); box-shadow: 0 6px 20px rgba(184, 134, 47, 0.5); }
    .play-surah.small { width: 32px; height: 32px; font-size: 12px; box-shadow: none; background: var(--accent); }

    /* --- Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ --- */
    .page-text { 
      font-family: var(--serif); font-size: 26px; line-height: 2.3; 
      text-align: justify; text-align-last: center; display: block;
    }

    .verse { cursor: pointer; padding: 4px 0; border-radius: 6px; transition: 0.2s; display: inline; }
    .verse:hover { background: rgba(184, 134, 47, 0.06); }
    
    /* Highlight Styles */
    .verse.marked-gold { background: rgba(184, 134, 47, 0.15); border-bottom: 2px solid #b8862f; }
    .verse.marked-green { background: rgba(16, 185, 129, 0.15); border-bottom: 2px solid #10b981; }
    .verse.marked-red { background: rgba(239, 68, 68, 0.15); border-bottom: 2px solid #ef4444; }

    /* ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© */
    .verse.playing-verse {
      background-color: rgba(184, 134, 47, 0.3) !important;
      box-shadow: 0 0 0 2px rgba(184, 134, 47, 0.4);
      border-radius: 6px; color: var(--ink);
    }

    .verse-num {
      font-family: var(--sans); font-size: 14px; color: var(--accent); font-weight: bold;
      margin: 0 6px; display: inline-flex; width: 30px; height: 30px;
      border: 1px solid var(--accent); border-radius: 50%; align-items: center; justify-content: center;
    }

    /* --- Sidebar & Modal --- */
    .sidebar {
      position: fixed; right: -100%; top: 0; bottom: 0; width: 85%; max-width: 320px;
      background: var(--bg); z-index: 2000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 20px; display: flex; flex-direction: column; box-shadow: -10px 0 30px rgba(0,0,0,0.5);
    }
    .sidebar.open { right: 0; }
    
    .toc { flex: 1; overflow-y: auto; margin-top: 20px; padding-right: 5px; }
    .toc a {
      display: flex; justify-content: space-between; padding: 14px;
      background: rgba(255,255,255,0.05); margin-bottom: 8px; border-radius: 12px;
      text-decoration: none; color: #fff; font-size: 14px; border: 1px solid rgba(255,255,255,0.05);
    }

    .tafsir-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: flex-end; justify-content: center; z-index: 3000; }
    .tafsir-panel { background: var(--paper); width: 100%; max-width: 600px; border-radius: 30px 30px 0 0; padding: 25px; max-height: 80vh; overflow-y: auto; }
    
    .choice-btn {
      background: var(--paper); color: var(--ink); border: 1px solid rgba(128, 128, 128, 0.15);
      padding: 14px; border-radius: 14px; font-weight: 700; font-size: 14px; text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); width: 100%;
    }
    .choice-btn:hover {
      border-color: var(--accent); background: rgba(184, 134, 47, 0.05);
      transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .choice-btn[style*="background:var(--accent)"] {
      background: linear-gradient(135deg, var(--accent), #b38028) !important;
      color: #fff !important; box-shadow: 0 5px 15px rgba(184, 134, 47, 0.3) !important; border: none !important;
    }
    .choice-btn[style*="background:var(--accent)"]:hover {
      filter: brightness(1.1); transform: translateY(-2px) scale(1.01);
    }

    .mark-tools { display: flex; align-items: center; gap: 12px; margin: 15px 0; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 12px; }
    .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; }
    
    #clearMarkBtn {
      background: transparent !important; border: 1px solid var(--muted) !important; color: var(--muted) !important;
      border-radius: 6px; padding: 4px 10px !important; font-size: 11px; font-weight: bold; transition: 0.2s;
    }
    #clearMarkBtn:hover { background: rgba(239, 68, 68, 0.1) !important; border-color: #ef4444 !important; color: #ef4444 !important; }

    #tafsirClose { background: rgba(128, 128, 128, 0.1) !important; color: var(--ink); transition: 0.2s; }
    #tafsirClose:hover { background: rgba(239, 68, 68, 0.1) !important; color: #ef4444; transform: rotate(90deg); }

    #closeMenu {
      background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.05); margin-top: 20px !important;
    }
    #closeMenu:hover { background: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.5); color: #fff; }

    /* Responsive */
    @media (max-width: 767px) {
      .app-bar { padding: 10px 15px; }
      .reader-wrap { padding: 10px; }
      .mushaf-card { background: transparent; box-shadow: none; border-radius: 8px; padding: 6px 6px 40px 6px; margin: 0; min-height: auto; max-width: none; }
      .page-text { font-size: 20px; line-height: 2.1; text-align: right; display: grid; grid-template-columns: 1fr; gap: 8px; }
      .verse { display: block; padding: 12px 14px; background: rgba(255,255,255,0.02); border-radius: 12px; margin: 0; font-size: 20px; }
      .verse-num { float: left; margin-left: 8px; }
    }
    @media (min-width: 768px) {
      .sidebar { position: static; right: 0; width: 350px; margin: 15px; border-radius: 20px; }
      .tafsir-modal { align-items: center; padding: 20px; }
      .tafsir-panel { border-radius: 25px; }
    }
    :root {
      /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØµØ¨Ø§Ø­ÙŠ */
      --bg: #f0f2f5; 
      --paper: #ffffff; 
      --muted: #64748b; 
      --accent: #b8862f;
      --ink: #1e293b; 
      --radius: 20px; 
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --sans: 'Cairo', sans-serif; 
      --serif: 'Amiri', serif;
      --header-bg: rgba(255, 255, 255, 0.8);
      --header-text: #1e293b;
    }

    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
    body.dark { 
      --bg: #0f172a; 
      --paper: #1e293b; 
      --ink: #f1f5f9; 
      --muted: #94a3b8; 
      --shadow: 0 10px 30px rgba(0,0,0,0.5);
      --header-bg: rgba(15, 23, 42, 0.8);
      --header-text: #ffffff;
    }

    body { 
      margin: 0; 
      background: var(--bg); 
      font-family: var(--sans); 
      color: var(--ink); 
      transition: background 0.3s, color 0.3s; 
    }

    header.app-bar {
      padding: 12px 20px; 
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      background: var(--header-bg); 
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(128,128,128,0.1); 
      z-index: 1000; 
      position: sticky;
      top: 0;
    }
    
    .brand .title { color: var(--header-text); }
    
  </style>

  <style>
  :root {
    /* Ø£Ù„ÙˆØ§Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø± (Ø§Ù„ØµØ¨Ø§Ø­ÙŠ) */
    --bg: #f8fafc; 
    --paper: #ffffff; 
    --muted: #64748b; 
    --accent: #b8862f;
    --ink: #1e293b; 
    --radius: 20px; 
    --shadow: 0 10px 40px rgba(0,0,0,0.06);
    --sans: 'Cairo', sans-serif; 
    --serif: 'Amiri', serif;
    --header-bg: rgba(255, 255, 255, 0.9);
    --btn-bg: rgba(0, 0, 0, 0.05); /* Ø²Ø± Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ */
    --btn-text: #1e293b;         /* Ù†Øµ Ø§Ù„Ø²Ø± Ø£Ø³ÙˆØ¯ */
    --border: rgba(0, 0, 0, 0.1);
  }

  body.dark { 
    /* Ø£Ù„ÙˆØ§Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ */
    --bg: #000; 
    --paper: #18181B; 
    --ink: #f1f5f9; 
    --muted: #ffffff; 
    --shadow: 0 10px 40px rgb(0, 0, 0);
    --header-bg: rgba(15, 23, 42, 0.9);
    --btn-bg: rgba(255, 255, 255, 0.1); /* Ø²Ø± Ø´ÙØ§Ù Ø£Ø¨ÙŠØ¶ */
    --btn-text: #ffffff;             /* Ù†Øµ Ø§Ù„Ø²Ø± Ø£Ø¨ÙŠØ¶ */
    --border: rgba(255, 255, 255, 0.1);
  }

  body { margin: 0; background: var(--bg); font-family: var(--sans); color: var(--ink); transition: 0.3s; }

  /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
  header.app-bar {
    padding: 12px 20px; display: flex; align-items: center; justify-content: space-between;
    background: var(--header-bg); backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000;
  }
  .brand .title { color: var(--ink); font-size: 18px; margin: 0; }

  /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© */
  .btn, .btn-icon, .reciter-select {
    background: var(--btn-bg); border: 1px solid var(--border);
    color: var(--btn-text); border-radius: 12px; cursor: pointer;
    transition: 0.2s; font-family: var(--sans);
  }
  .btn-icon { width: 40px; height: 40px; font-size: 18px; display: flex; align-items: center; justify-content: center; }
  .btn:hover, .btn-icon:hover { background: var(--accent); color: white; }

  /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØµØ­Ù */
  .mushaf-card {
    background: var(--paper); border-radius: var(--radius); padding: 40px 25px;
    box-shadow: var(--shadow); max-width: 800px; margin: 20px auto; color: var(--ink);
  }

  /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
  .sidebar { background: var(--paper); color: var(--ink); box-shadow: -10px 0 30px var(--shadow); }
  .toc a { background: var(--btn-bg); color: var(--ink); text-decoration: none; }

  /* Ø§Ù„ØªÙØ³ÙŠØ± */
  .tafsir-panel { background: var(--paper); color: var(--ink); }
  .choice-btn { background: var(--btn-bg); color: var(--ink); border: 1px solid var(--border); cursor: pointer; }
</style>
</head>
<body class="dark">

<div class="app">
  <header class="app-bar">
    <div class="brand">
      <h1 class="title">Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ</h1>
      <div class="subtitle">Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆÙ…ØªØ§Ø¨Ø¹Ø©</div>
    </div>
    
    <select id="reciterSelect" class="reciter-select"></select>

    <div style="display:flex; gap:8px; align-items:center;">
      <button class="btn-icon" id="toggleTheme">ğŸŒ“</button>
      <button class="btn" id="btnRandom" title="ÙØªØ­ ØµÙØ­Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©">ğŸ²</button>
      <button class="btn" id="openMenu">â˜°</button>
    </div>
  </header>

  <div class="shell">
    <main class="reader-wrap" id="readerWrap">
      <div class="mushaf-card" id="mushafCard">
        <div id="pageMeta" style="text-align: center; color: var(--muted); font-size: 13px; margin-bottom: 6px;">
          ØµÙØ­Ø© <span id="pageIdx">1</span>
        </div>
        <div id="locationHint" class="location-hint"></div>
        <article id="mushafContent" class="page-text">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</article>
      </div>
    </main>

    <aside class="sidebar" id="sidebar">
      <h2 style="color:#fff; margin-bottom:15px;">ÙÙ‡Ø±Ø³ Ø§Ù„Ø³ÙˆØ±</h2>
      <div class="toc" id="toc"></div>
      <button id="closeMenu" class="btn" style="width:100%">Ø¥ØºÙ„Ø§Ù‚</button>
    </aside>
  </div>
</div>

<audio id="surahAudio" preload="auto"></audio>

<div id="tafsirModal" class="tafsir-modal">
  <div class="tafsir-panel">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 id="tafsirTitle" style="margin:0; color:var(--accent);">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¢ÙŠØ©</h3>
      <button id="tafsirClose" style="border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">âœ•</button>
    </div>
    <p id="tafsirMeta" style="color:var(--muted); font-size:14px; margin:10px 0;"></p>

    <div class="mark-tools">
      <span style="font-size:13px; font-weight:bold;">Ø¹Ù„Ø§Ù…Ø©:</span>
      <div class="color-dot" style="background:#b8862f" onclick="setMark('gold')"></div>
      <div class="color-dot" style="background:#10b981" onclick="setMark('green')"></div>
      <div class="color-dot" style="background:#ef4444" onclick="setMark('red')"></div>
      <button id="clearMarkBtn">Ø­Ø°Ù</button>
    </div>

    <div style="display:grid; grid-template-columns: 1fr; gap:10px; margin-bottom:15px;" id="ksuButtons"></div>
    
    <div id="tafsirContent" style="background:rgba(0,0,0,0.03); padding:15px; border-radius:15px; line-height:1.8; font-size:17px; font-family:var(--serif);"></div>
  </div>
</div>
<script>
  // ÙƒÙˆØ¯ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… Ù…Ø¹ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
  const toggleBtn = document.getElementById('toggleTheme');
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø³Ø§Ø¨Ù‚Ø§Ù‹
  if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
  }

  toggleBtn.onclick = () => {
    document.body.classList.toggle('dark');
    // Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„
    if (document.body.classList.contains('dark')) {
        localStorage.setItem('theme', 'dark');
    } else {
        localStorage.setItem('theme', 'light');
    }
  };
</script>
<script>
(function(){
const TOTAL_PAGES = 604;

const SURA_TABLE = [
    {n:1, s:'Ø§Ù„ÙØ§ØªØ­Ø©', p:1},
    {n:2, s:'Ø§Ù„Ø¨Ù‚Ø±Ø©', p:2},
    {n:3, s:'Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†', p:50},
    {n:4, s:'Ø§Ù„Ù†Ø³Ø§Ø¡', p:77},
    {n:5, s:'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©', p:106},
    {n:6, s:'Ø§Ù„Ø£Ù†Ø¹Ø§Ù…', p:128},
    {n:7, s:'Ø§Ù„Ø£Ø¹Ø±Ø§Ù', p:151},
    {n:8, s:'Ø§Ù„Ø£Ù†ÙØ§Ù„', p:177},
    {n:9, s:'Ø§Ù„ØªÙˆØ¨Ø©', p:187},
    {n:10, s:'ÙŠÙˆÙ†Ø³', p:208},
    {n:11, s:'Ù‡ÙˆØ¯', p:221},
    {n:12, s:'ÙŠÙˆØ³Ù', p:234},
    {n:13, s:'Ø§Ù„Ø±Ø¹Ø¯', p:249},
    {n:14, s:'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…', p:255},
    {n:15, s:'Ø§Ù„Ø­Ø¬Ø±', p:262},
    {n:16, s:'Ø§Ù„Ù†Ø­Ù„', p:267},
    {n:17, s:'Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡', p:282},
    {n:18, s:'Ø§Ù„ÙƒÙ‡Ù', p:293},
    {n:19, s:'Ù…Ø±ÙŠÙ…', p:305},
    {n:20, s:'Ø·Ù‡', p:312},
    {n:21, s:'Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡', p:322},
    {n:22, s:'Ø§Ù„Ø­Ø¬', p:332},
    {n:23, s:'Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†', p:342},
    {n:24, s:'Ø§Ù„Ù†ÙˆØ±', p:350},
    {n:25, s:'Ø§Ù„ÙØ±Ù‚Ø§Ù†', p:359},
    {n:26, s:'Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡', p:367},
    {n:27, s:'Ø§Ù„Ù†Ù…Ù„', p:377},
    {n:28, s:'Ø§Ù„Ù‚ØµØµ', p:385},
    {n:29, s:'Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª', p:396},
    {n:30, s:'Ø§Ù„Ø±ÙˆÙ…', p:404},
    {n:31, s:'Ù„Ù‚Ù…Ø§Ù†', p:411},
    {n:32, s:'Ø§Ù„Ø³Ø¬Ø¯Ø©', p:415},
    {n:33, s:'Ø§Ù„Ø£Ø­Ø²Ø§Ø¨', p:418},
    {n:34, s:'Ø³Ø¨Ø£', p:428},
    {n:35, s:'ÙØ§Ø·Ø±', p:434},
    {n:36, s:'ÙŠØ³', p:440},
    {n:37, s:'Ø§Ù„ØµØ§ÙØ§Øª', p:446},
    {n:38, s:'Øµ', p:453},
    {n:39, s:'Ø§Ù„Ø²Ù…Ø±', p:458},
    {n:40, s:'ØºØ§ÙØ±', p:467},
    {n:41, s:'ÙØµÙ„Øª', p:477},
    {n:42, s:'Ø§Ù„Ø´ÙˆØ±Ù‰', p:483},
    {n:43, s:'Ø§Ù„Ø²Ø®Ø±Ù', p:489},
    {n:44, s:'Ø§Ù„Ø¯Ø®Ø§Ù†', p:496},
    {n:45, s:'Ø§Ù„Ø¬Ø§Ø«ÙŠØ©', p:499},
    {n:46, s:'Ø§Ù„Ø£Ø­Ù‚Ø§Ù', p:502},
    {n:47, s:'Ù…Ø­Ù…Ø¯', p:507},
    {n:48, s:'Ø§Ù„ÙØªØ­', p:511},
    {n:49, s:'Ø§Ù„Ø­Ø¬Ø±Ø§Øª', p:515},
    {n:50, s:'Ù‚', p:518},
    {n:51, s:'Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª', p:520},
    {n:52, s:'Ø§Ù„Ø·ÙˆØ±', p:523},
    {n:53, s:'Ø§Ù„Ù†Ø¬Ù…', p:526},
    {n:54, s:'Ø§Ù„Ù‚Ù…Ø±', p:528},
    {n:55, s:'Ø§Ù„Ø±Ø­Ù…Ù†', p:531},
    {n:56, s:'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©', p:534},
    {n:57, s:'Ø§Ù„Ø­Ø¯ÙŠØ¯', p:537},
    {n:58, s:'Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©', p:542},
    {n:59, s:'Ø§Ù„Ø­Ø´Ø±', p:545},
    {n:60, s:'Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©', p:549},
    {n:61, s:'Ø§Ù„ØµÙ', p:551},
    {n:62, s:'Ø§Ù„Ø¬Ù…Ø¹Ø©', p:553},
    {n:63, s:'Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†', p:554},
    {n:64, s:'Ø§Ù„ØªØºØ§Ø¨Ù†', p:556},
    {n:65, s:'Ø§Ù„Ø·Ù„Ø§Ù‚', p:558},
    {n:66, s:'Ø§Ù„ØªØ­Ø±ÙŠÙ…', p:560},
    {n:67, s:'Ø§Ù„Ù…Ù„Ùƒ', p:562},
    {n:68, s:'Ø§Ù„Ù‚Ù„Ù…', p:564},
    {n:69, s:'Ø§Ù„Ø­Ø§Ù‚Ø©', p:566},
    {n:70, s:'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬', p:568},
    {n:71, s:'Ù†ÙˆØ­', p:570},
    {n:72, s:'Ø§Ù„Ø¬Ù†', p:572},
    {n:73, s:'Ø§Ù„Ù…Ø²Ù…Ù„', p:574},
    {n:74, s:'Ø§Ù„Ù…Ø¯Ø«Ø±', p:575},
    {n:75, s:'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©', p:577},
    {n:76, s:'Ø§Ù„Ø¥Ù†Ø³Ø§Ù†', p:578},
    {n:77, s:'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª', p:580},
    {n:78, s:'Ø§Ù„Ù†Ø¨Ø£', p:582},
    {n:79, s:'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª', p:583},
    {n:80, s:'Ø¹Ø¨Ø³', p:585},
    {n:81, s:'Ø§Ù„ØªÙƒÙˆÙŠØ±', p:586},
    {n:82, s:'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±', p:587},
    {n:83, s:'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†', p:587},
    {n:84, s:'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚', p:589},
    {n:85, s:'Ø§Ù„Ø¨Ø±ÙˆØ¬', p:590},
    {n:86, s:'Ø§Ù„Ø·Ø§Ø±Ù‚', p:591},
    {n:87, s:'Ø§Ù„Ø£Ø¹Ù„Ù‰', p:591},
    {n:88, s:'Ø§Ù„ØºØ§Ø´ÙŠØ©', p:592},
    {n:89, s:'Ø§Ù„ÙØ¬Ø±', p:593},
    {n:90, s:'Ø§Ù„Ø¨Ù„Ø¯', p:594},
    {n:91, s:'Ø§Ù„Ø´Ù…Ø³', p:595},
    {n:92, s:'Ø§Ù„Ù„ÙŠÙ„', p:595},
    {n:93, s:'Ø§Ù„Ø¶Ø­Ù‰', p:596},
    {n:94, s:'Ø§Ù„Ø´Ø±Ø­', p:596},
    {n:95, s:'Ø§Ù„ØªÙŠÙ†', p:597},
    {n:96, s:'Ø§Ù„Ø¹Ù„Ù‚', p:597},
    {n:97, s:'Ø§Ù„Ù‚Ø¯Ø±', p:598},
    {n:98, s:'Ø§Ù„Ø¨ÙŠÙ†Ø©', p:598},
    {n:99, s:'Ø§Ù„Ø²Ù„Ø²Ù„Ø©', p:599},
    {n:100, s:'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª', p:599},
    {n:101, s:'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©', p:600},
    {n:102, s:'Ø§Ù„ØªÙƒØ§Ø«Ø±', p:600},
    {n:103, s:'Ø§Ù„Ø¹ØµØ±', p:601},
    {n:104, s:'Ø§Ù„Ù‡Ù…Ø²Ø©', p:601},
    {n:105, s:'Ø§Ù„ÙÙŠÙ„', p:601},
    {n:106, s:'Ù‚Ø±ÙŠØ´', p:602},
    {n:107, s:'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†', p:602},
    {n:108, s:'Ø§Ù„ÙƒÙˆØ«Ø±', p:602},
    {n:109, s:'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†', p:603},
    {n:110, s:'Ø§Ù„Ù†ØµØ±', p:603},
    {n:111, s:'Ø§Ù„Ù…Ø³Ø¯', p:603},
    {n:112, s:'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ', p:604},
    {n:113, s:'Ø§Ù„ÙÙ„Ù‚', p:604},
    {n:114, s:'Ø§Ù„Ù†Ø§Ø³', p:604}
  ];

  let currentPage = Number(localStorage.getItem('mushaf_page')) || 1;
  let currentVerse = null;
  let bookmarks = JSON.parse(localStorage.getItem('mushaf_bookmarks')) || {};

  // --- ØªØ¹Ø±ÙŠÙ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡ ---
  const RECITERS = [
      { id: 'alafasy', name: 'Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ', surahServer: 'https://server8.mp3quran.net/afs/', ayahServer: 'Alafasy_128kbps' },
      { id: 'ajmi', name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø¬Ù…ÙŠ', surahServer: 'https://server10.mp3quran.net/ajm/', ayahServer: 'Ahmed_ibn_Ali_al-Ajamy_128kbps' },
      { id: 'minshawy', name: 'Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ', surahServer: 'https://server10.mp3quran.net/minsh/', ayahServer: 'Minshawy_Murattal_128kbps' },
      { id: 'wadee', name: 'ÙˆØ¯ÙŠØ¹ Ø§Ù„ÙŠÙ…Ù†ÙŠ', surahServer: 'https://server6.mp3quran.net/wdee3/', ayahServer: 'Alafasy_128kbps' },
      { id: 'husary', name: 'Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ', surahServer: 'https://server13.mp3quran.net/husr/', ayahServer: 'Husary_128kbps' },
      { id: 'yasser', name: 'ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', surahServer: 'https://server11.mp3quran.net/yasser/', ayahServer: 'Yasser_Ad-Dussary_128kbps' },
      { id: 'jaber', name: 'Ø¹Ù„ÙŠ Ø¬Ø§Ø¨Ø±', surahServer: 'https://server11.mp3quran.net/a_jbr/', ayahServer: 'Ali_Jaber_64kbps' }
  ];

  let savedReciterId = localStorage.getItem('mushaf_reciter') || 'alafasy';
  let activeReciter = RECITERS.find(r => r.id === savedReciterId) || RECITERS[0];

  const reciterSelect = document.getElementById('reciterSelect');
  RECITERS.forEach(r => {
      const opt = document.createElement('option');
      opt.value = r.id;
      opt.textContent = r.name;
      if(r.id === activeReciter.id) opt.selected = true;
      reciterSelect.appendChild(opt);
  });

  reciterSelect.addEventListener('change', (e) => {
      const selectedId = e.target.value;
      activeReciter = RECITERS.find(r => r.id === selectedId);
      localStorage.setItem('mushaf_reciter', selectedId);
      surahAudio.pause();
      isVersePlaying = false;
      activeSurahPlaying = null;
      if(activePlayButton) activePlayButton.textContent = 'ğŸ”Š';
      activePlayButton = null;
      document.querySelectorAll('.playing-verse').forEach(el => el.classList.remove('playing-verse'));
  });

  const surahAudio = document.getElementById('surahAudio');
  let activePlayButton = null;
  let activeSurahPlaying = null;
  let isVersePlaying = false;
  let currentPlayingSurah = 0;
  let currentPlayingAyah = 0;

  function pad3(num) {
    return String(Number(num)).padStart(3, '0');
  }

  // --- Page Loading ---
  async function loadPage(p) {
    if (p < 1 || p > 604) return;
    currentPage = p;
    localStorage.setItem('mushaf_page', p);
    const content = document.getElementById('mushafContent');
    content.innerHTML = '<div style="text-align:center; padding:50px;">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...</div>';
    document.getElementById('locationHint').textContent = '';
    
    try {
      const res = await fetch(`https://api.alquran.cloud/v1/page/${p}/quran-uthmani`);
      const data = await res.json();
      const ayahs = data.data.ayahs;
      
      document.getElementById('pageIdx').textContent = p;
      if (ayahs && ayahs.length) {
        const surahStarts = ayahs.filter(a => a.numberInSurah === 1).map(a => a.surah.name);
        const visibleSurah = surahStarts.length ? surahStarts[0] : ayahs[0].surah.name;
        document.getElementById('locationHint').textContent = `Ø³ÙˆØ±Ø© ${visibleSurah} â€” ØµÙØ­Ø© ${p}`;
      }
      
      let htmlOutput = "";
      
      // Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø«Ù…Ø§Ù†ÙŠ Ù„Ù„Ø¨Ø³Ù…Ù„Ø© Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ù„Ø­Ø°Ù
      const uthmaniBasmalah = "Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ù±Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù";

      ayahs.forEach(a => {
        let text = a.text;
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³ÙˆØ±Ø©
        if (a.numberInSurah === 1) {
          htmlOutput += `
            <div class="surah-block">
              <div class="surah-name-frame">
                <span>Ø³ÙˆØ±Ø© ${a.surah.name}</span>
                <button class="play-surah small" data-surah="${a.surah.number}">ğŸ”Š</button>
              </div>
            </div>`;
          
          // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„ÙØ§ØªØ­Ø© (1) ÙˆÙ„Ø§ Ø§Ù„ØªÙˆØ¨Ø© (9)
          if (a.surah.number !== 1 && a.surah.number !== 9) {
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø³Ù…Ù„Ø© Ø§Ù„Ù…Ø²Ø®Ø±ÙØ©
            htmlOutput += `<div class="basmalah-decorated">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ù±Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù</div>`;
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ: Ø­Ø°Ù Ø§Ù„Ø¨Ø³Ù…Ù„Ø© Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¢ÙŠØ© Ù„Ø¹Ø±Ø¶ "Ø§Ù„Ù…" ÙÙ‚Ø·
            if (text.startsWith(uthmaniBasmalah)) {
                text = text.substring(uthmaniBasmalah.length).trim();
            }
          }
        }
        
        htmlOutput += `
          <span class="verse" 
                id="verse-${a.surah.number}-${a.numberInSurah}"
                data-surah="${a.surah.number}" 
                data-ayah="${a.numberInSurah}" 
                data-sname="${a.surah.name}">
            ${text} <span class="verse-num">${a.numberInSurah}</span>
          </span>`;
      });
      
      content.innerHTML = htmlOutput;
      applyMarksToUI();
      
      if (isVersePlaying) highlightPlayingVerse(currentPlayingSurah, currentPlayingAyah);
      document.querySelector('.reader-wrap').scrollTop = 0;
      
    } catch(e) { 
      console.error(e);
      content.innerHTML = '<div style="text-align:center; color:red">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„</div>'; 
    }
  }

  // --- Marks Logic ---
  function applyMarksToUI() {
    document.querySelectorAll('.verse').forEach(v => {
      const key = `${v.dataset.surah}_${v.dataset.ayah}`;
      v.classList.remove('marked-gold', 'marked-green', 'marked-red');
      if (bookmarks[key]) v.classList.add(`marked-${bookmarks[key]}`);
    });
  }

  window.setMark = (color) => {
    if(!currentVerse) return;
    const key = `${currentVerse.surah}_${currentVerse.ayah}`;
    bookmarks[key] = color;
    localStorage.setItem('mushaf_bookmarks', JSON.stringify(bookmarks));
    applyMarksToUI();
    document.getElementById('tafsirModal').style.display = 'none';
  };

  document.getElementById('clearMarkBtn').onclick = () => {
    if(!currentVerse) return;
    const key = `${currentVerse.surah}_${currentVerse.ayah}`;
    delete bookmarks[key];
    localStorage.setItem('mushaf_bookmarks', JSON.stringify(bookmarks));
    applyMarksToUI();
    document.getElementById('tafsirModal').style.display = 'none';
  };

  // --- Audio Playback Logic ---
  
  function highlightPlayingVerse(surah, ayah) {
    document.querySelectorAll('.playing-verse').forEach(el => el.classList.remove('playing-verse'));
    const verseEl = document.getElementById(`verse-${surah}-${ayah}`);
    if (verseEl) {
        verseEl.classList.add('playing-verse');
        verseEl.scrollIntoView({behavior: "smooth", block: "center"});
    }
  }

  // ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚ÙØ² (basmalahJump) Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ù‡Ù†Ø§ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙØ±
  surahAudio.onloadedmetadata = () => {
     // Ø§Ù„Ù…Ù„Ù Ø³ÙŠØ¹Ù…Ù„ Ù…Ù† Ø¨Ø¯Ø§ÙŠØªÙ‡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (0:00)
  };

  window.playVerseSequence = (surah, ayah) => {
    if(activeSurahPlaying) {
        surahAudio.pause();
        if(activePlayButton) activePlayButton.textContent = 'ğŸ”Š';
        activeSurahPlaying = null;
    }

    isVersePlaying = true;
    currentPlayingSurah = Number(surah);
    currentPlayingAyah = Number(ayah);
    
    document.getElementById('tafsirModal').style.display = 'none';
    highlightPlayingVerse(currentPlayingSurah, currentPlayingAyah);

    const url = `https://everyayah.com/data/${activeReciter.ayahServer}/${pad3(currentPlayingSurah)}${pad3(currentPlayingAyah)}.mp3`;

    surahAudio.src = url;
    surahAudio.currentTime = 0; // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    surahAudio.play().catch(e => { console.error("Audio play failed", e); });

    surahAudio.onended = () => {
          playVerseSequence(currentPlayingSurah, currentPlayingAyah + 1);
    };
    
    surahAudio.onerror = () => {
          if (currentPlayingSurah < 114) {
              playVerseSequence(currentPlayingSurah + 1, 1);
          } else {
              isVersePlaying = false;
              document.querySelectorAll('.playing-verse').forEach(el => el.classList.remove('playing-verse'));
              alert('ØªÙ… Ø®ØªÙ… Ø§Ù„Ù…ØµØ­Ù.');
          }
    };
  };

  // --- Interaction ---
  document.getElementById('mushafContent').addEventListener('click', e => {
    const v = e.target.closest('.verse');
    if(!v) return;
    currentVerse = v.dataset;
    
    document.getElementById('tafsirTitle').textContent = `Ø³ÙˆØ±Ø© ${v.dataset.sname}`;
    document.getElementById('tafsirMeta').textContent = `Ø§Ù„Ø¢ÙŠØ© ${v.dataset.ayah}`;
    document.getElementById('tafsirContent').innerHTML = "Ø§Ø®ØªØ± Ø®ÙŠØ§Ø±Ø§Ù‹...";
    
    const ksu = document.getElementById('ksuButtons');
    ksu.innerHTML = `
      <button class="choice-btn" style="background:var(--accent); color:#fff; font-size:15px; grid-column:1/-1;" 
              onclick="playVerseSequence(${v.dataset.surah}, ${v.dataset.ayah})">
        â–¶ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢ÙŠØ© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
      </button>
      <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; width:100%;">
        ${[
          {id:'saadi', l:'Ø§Ù„Ø³Ø¹Ø¯ÙŠ'}, {id:'katheer', l:'Ø§Ø¨Ù† ÙƒØ«ÙŠØ±'}, {id:'qortobi', l:'Ø§Ù„Ù‚Ø±Ø·Ø¨ÙŠ'}
        ].map(t => `
          <button class="choice-btn" style="background:rgba(255,255,255,0.1);" 
            onclick="window.open('https://quran.ksu.edu.sa/tafseer/${t.id}/sura${v.dataset.surah}-aya${v.dataset.ayah}.html')">
            ${t.l}
          </button>
        `).join('')}
      </div>
    `;
    
    fetch(`https://api-quran.com/api?type=tafser2&surah=${v.dataset.surah}&ayah=${v.dataset.ayah}`)
      .then(r => r.json())
      .then(d => document.getElementById('tafsirContent').innerHTML = d.result || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ³ÙŠØ± Ù…ØªØ§Ø­")
      .catch(() => document.getElementById('tafsirContent').innerHTML = "ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙØ§Ø³ÙŠØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ø£Ø¹Ù„Ø§Ù‡");

    document.getElementById('tafsirModal').style.display = 'flex';
  });

  window.goToPage = (p) => { loadPage(p); document.getElementById('sidebar').classList.remove('open'); };
  document.getElementById('openMenu').onclick = () => document.getElementById('sidebar').classList.add('open');
  document.getElementById('closeMenu').onclick = () => document.getElementById('sidebar').classList.remove('open');
  document.getElementById('tafsirClose').onclick = () => document.getElementById('tafsirModal').style.display = 'none';
  document.getElementById('toggleTheme').onclick = () => document.body.classList.toggle('dark');
  document.getElementById('btnRandom').onclick = () => loadPage(Math.floor(Math.random() * 604) + 1);

  document.getElementById('toc').innerHTML = SURA_TABLE.map(s => `
    <a href="#" onclick="event.preventDefault(); window.goToPage(${s.p})">
      <span>${s.n}. ${s.s}</span><span style="opacity:0.6">Øµ ${s.p}</span>
    </a>
  `).join('');

  loadPage(currentPage);

  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.play-surah');
    if (!btn) return;
    const surahNum = btn.dataset.surah;
    
    if(isVersePlaying) {
        isVersePlaying = false;
        document.querySelectorAll('.playing-verse').forEach(el => el.classList.remove('playing-verse'));
        surahAudio.pause();
        surahAudio.onended = null; 
        surahAudio.onerror = null;
    }

    if (activeSurahPlaying === surahNum) {
      if (surahAudio.paused) { surahAudio.play(); btn.textContent = 'â¸'; }
      else { surahAudio.pause(); btn.textContent = 'ğŸ”Š'; }
      return;
    }

    if (activePlayButton && activePlayButton !== btn) activePlayButton.textContent = 'ğŸ”Š';
    activePlayButton = btn; activeSurahPlaying = surahNum;

    surahAudio.onended = () => { if (activePlayButton) activePlayButton.textContent = 'ğŸ”Š'; activeSurahPlaying = null; };
    
    surahAudio.src = `${activeReciter.surahServer}${pad3(surahNum)}.mp3`;
    surahAudio.currentTime = 0;
    surahAudio.play().then(() => btn.textContent = 'â¸').catch(err => { console.warn(err); btn.textContent = 'ğŸ”Š'; });
  });

  const reader = document.getElementById('readerWrap');
  let startX = 0, startY = 0, isPointerDown = false;
  reader.addEventListener('touchstart', (ev) => {
    if (!ev.touches.length) return;
    startX = ev.touches[0].clientX; startY = ev.touches[0].clientY; isPointerDown = true;
  }, {passive: true});
  reader.addEventListener('touchend', (ev) => {
    if (!isPointerDown) return; isPointerDown = false;
    const t = ev.changedTouches[0];
    const dx = t.clientX - startX, dy = t.clientY - startY;
    if (Math.abs(dx) > 60 && Math.abs(dx) > Math.abs(dy)) {
      if (dx < 0) loadPage(currentPage + 1); else loadPage(currentPage - 1);
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') loadPage(currentPage - 1);
    if (e.key === 'ArrowRight') loadPage(currentPage + 1);
  });

})();
</script>
</body>
</html>

